# Piper - Flutter State Management Library

# Default recipe: list available commands
default:
    @just --list

# Run all tests
test:
    dart test

# Run tests with coverage
test-coverage:
    dart test --coverage=coverage
    dart pub global activate coverage
    dart pub global run coverage:format_coverage --lcov --in=coverage --out=coverage/lcov.info --report-on=lib
    @echo "Coverage report generated at coverage/lcov.info"

# Run tests with coverage and open HTML report (requires lcov)
test-coverage-html: test-coverage
    genhtml coverage/lcov.info -o coverage/html
    @echo "HTML report generated at coverage/html/index.html"
    open coverage/html/index.html || xdg-open coverage/html/index.html || echo "Open coverage/html/index.html in your browser"

# Analyze code for issues
analyze:
    dart analyze

# Format all Dart files
format:
    dart format .

# Check formatting without changes
format-check:
    dart format --set-exit-if-changed .

# Get dependencies for library and example
deps:
    dart pub get
    cd example && dart pub get

# Clean build artifacts
clean:
    dart clean
    cd example && dart clean

# Publish package
publish-dry-run:
    dart pub publish --dry-run

# Publish package
publish:
    dart pub publish

bump-version:
    dart run change_version --version-file pubspec.yaml

# Run library tests and analyze
ci: deps analyze test